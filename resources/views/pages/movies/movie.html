{% extends 'layout/base.html' %}{% block container %}

<section class="section pb-42 md:pb-16">
	<div class="wrapper">
		<div
			class="bg-linear-to-r from-black mb-8 p-2 rounded-sm text-center md:text-left"
		>
			<h3
				class="normal-case font-semibold border-l-4 border-solid border-poppy w-fit pl-4 text-3xl leading-8 flex flex-col gap-2"
			>
				<span class="font-medium text-base">Postado por:</span>
				<a
					href="/usuario/{{ movie.userId }}"
					class="flex items-center gap-3 bg-linear-to-r from-deep py-1 px-2 rounded-sm transition-all duration-200 ease-in-out"
				>
					<img
						src="{{ user_image(owner.image) }}"
						alt="User Name"
						class="rounded-sm h-7 w-7 object-cover object-center ring-1 ring-poppy shadow-xl shadow-egg/20"
					/>
					<span class="font-normal capitalize text-egg font-headline text-xl"
						>{{ owner.firstName }} {{ owner.lastName }}</span
					>
				</a>
			</h3>
		</div>

		<div class="grid sm:grid-cols-7 gap-6 items-stretch">
			<div
				class="flex flex-col gap-4 sm:col-span-4 md:col-span-5 col-span-full"
			>
				<div
					class="bg-deep p-2 rounded-sm text-center md:text-left ring-1 ring-gray-800 shadow-xl shadow-gray-900/80"
				>
					<h1
						class="normal-case font-semibold border-l-4 border-solid border-egg w-fit pl-4 text-3xl leading-8"
					>
						{{ movie.title }}
					</h1>
				</div>

				<div
					class="p-2 bg-deep rounded-sm ring-1 ring-gray-800 shadow-xl shadow-gray-900/80"
				>
					<iframe
						class="w-full h-86"
						src="{{ movie.trailerUrl ? movie.trailerUrl : 'https://www.youtube.com/embed/KV9JqZPo26Y?si=2HhIbf-wU6GfT-Vn' }}"
						title="YouTube video player"
						frameborder="0"
						allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
						referrerpolicy="strict-origin-when-cross-origin"
						allowfullscreen
					></iframe>
				</div>

				<div
					x-data="{
          hidden: true,
          toggle() {
            this.hidden = !this.hidden
          }
        }"
					class="bg-deep p-2 rounded-sm text-center md:text-left ring-1 ring-gray-800 shadow-xl shadow-gray-900/80"
				>
					<p x-bind:class="hidden ? 'line-clamp-2' : 'line-clamp-none'">
						{{ movie.description }}
					</p>
					<button
						type="button"
						class="underline text-egg font-light transition-colors duration-200 ease-in-out hover:text-poppy"
						@click="toggle()"
						x-text="hidden ? 'mais' : 'menos'"
					></button>
				</div>
			</div>

			<div
				class="col-span-full sm:col-span-3 md:col-span-2 flex flex-col gap-4"
			>
				<div
					class="p-2 bg-deep rounded-sm ring-1 ring-gray-800 shadow-xl shadow-gray-900/80"
				>
					<img
						src="{{ movie_image(movie.image) }}"
						alt="Movie title"
						class="max-h-[415px] rounded-sm w-full object-center object-cover"
					/>
				</div>
				<div
					class="p-2 bg-deep rounded-sm flex flex-col ring-1 ring-gray-800 shadow-xl shadow-gray-900/80"
				>
					<p class="text-sm flex justify-between bg-dark p-1 rounded-sm mb-2">
						<strong class="text-egg">Duração:</strong>
						<span class="text-white">{{ movie.duration }} min</span>
					</p>
					<p class="text-sm flex justify-between bg-dark p-1 rounded-sm">
						<strong class="text-egg">Nota:</strong>
						<span>{{ rating }} <i class="ph-fill ph-star text-poppy"></i></span>
					</p>
				</div>
			</div>
		</div>

		<h3 class="my-10">Deixe seu comentário sobre esta crítica:</h3>

		{% if not is_logged_in() %}
		<p>
			Faça login para poder comentar.
			<a
				href="/login"
				class="text-egg transition-colors duration-200 ease-in-out hover:text-poppy"
				>Login</a
			>.
		</p>
		{% endif %}

		<div>
			{% if not alreadyReviewed and is_logged_in() %}
			<div>
				<form
					action="/review/filme"
					method="post"
					class="flex flex-col gap-2"
				>
					{{ csrf_token_input()|raw }}
					<input
						type="hidden"
						name="movieId"
						value="{{ movie.id }}"
					/>

					<div class="form-field h-auto">
						{% set input_value = persistent_input('comment') %}
						<textarea
							name="comment"
							id="comment"
							class="form-field-textarea"
							placeholder=""
							rows="6"
						>{{ input_value is null ? '' : input_value }}</textarea>
						<label
							for="comment"
							class="form-field-label"
							>Comentar</label
						>
						{% include "partials/form-input-error.html" with { name: 'comment' }
						%}
					</div>
					<div class="form-field w-1/10 self-end">
						{% set input_value = persistent_input('rating') %}
						<select
							name="rating"
							id="rating"
							class="form-field-select"
						>
							{% for i in range(1, 5) %}
							<option
								value="{{ i }}"
								class="bg-dark"
									{{ input_value is null ? '' : input_value == i ? 'selected' : '' }}
							>
								{{ i }}
							</option>
							{% endfor %}
						</select>
						<label
							for="rating"
							class="form-field-label"
							>Rating</label
						>
						{% include "partials/form-input-error.html" with { name: 'rating' }
						%}
					</div>

					<button
						type="submit"
						class="primary-btn"
					>
						Deixar review
					</button>
				</form>
			</div>
			{% endif %} {% if reviews is empty %}
			<p class="italic my-10 opacity-70 bg-black rounded-sm p-2">
				Sem comentários para mostrar
			</p>
			{% else %}
			<h3 class="my-10">Outros comentários:</h3>

			<div class="flex flex-col gap-4">
			{% for review in reviews %}
				<div class="bg-black rounded-sm p-2 shadow-white border-solid border-b-poppy border-b-4 relative">
					<div class="flex gap-3 items-center mb-4 bg-dark rounded-sm p-2">
						<img src="{{ user_image('') }}" alt="{{ review['firstName'] ~ ' ' ~ review['lastName'] }}" class="h-6 w-6 rounded-full ring-2 ring-egg">
						<h5 class="text-base capitalize font-normal">{{ review['firstName'] ~ ' ' ~ review['lastName'] }}</h5>
					</div>
					<p class="bg-deep rounded-sm p-2">{{ review['comment'] }}</p>
					<div class="absolute top-[10px] right-[10px] text-sm bg-black rounded-sm p-2">
						<span>{{ review['rating'] }}</span>
						<span><i class="ph ph-star text-egg"></i></span>
					</div>
				</div>
			{% endfor %}
			</div>
			
			{% include "partials/pagination.html" %}
			<!---->
			{% endif %}
		</div>
	</div>
</section>

{% endblock %}
